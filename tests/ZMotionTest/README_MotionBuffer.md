# 运动缓存测试功能使用说明

## 功能概述

运动缓存测试页面提供了对ZMotion运动控制器缓存功能的全面测试和监控，包括缓存状态查询、缓存运动命令和实时监控等功能。

## 界面布局

### 左侧区域：轴选择和缓存状态

#### 轴选择与基本信息
- **轴选择下拉框**：选择要测试的轴（0-31）
- **运行状态**：显示当前轴是否正在运动
- **使能状态**：显示当前轴的使能状态

#### 缓存状态监控
- **缓存移动数量**：当前缓存中的运动指令数量
- **是否有缓存**：显示是否还有未执行的缓存运动
- **当前移动标记**：当前正在执行的运动标记号
- **剩余缓存数量**：剩余的运动缓存容量
- **剩余直线缓存**：剩余的直线运动缓存数量
- **向量缓存距离**：当前运动和缓存运动的总距离

#### 缓存控制操作
- **清空缓存**：停止轴运动并清空所有缓存
- **暂停轴运动**：暂停当前轴的运动执行
- **恢复轴运动**：恢复暂停的轴运动
- **停止轴运动**：立即停止轴运动

### 中间区域：缓存命令测试

#### 基本缓存运动
- **移动距离1-3**：设置三个不同的移动距离值
- **移动标记**：设置运动标记号，用于运动执行跟踪
- **添加单次移动**：添加一个相对运动到缓存
- **添加序列移动**：连续添加三个运动指令到缓存
- **设置移动标记**：为后续运动设置标记号

#### 缓存IO控制
- **输出端口号**：要控制的数字输出端口
- **输出状态**：选择输出状态（关闭/打开）
- **延时时间**：设置延时的毫秒数
- **添加IO控制**：在运动缓存中插入IO控制指令
- **添加延时**：在运动缓存中插入延时指令

#### 自定义缓存命令
- **命令输入框**：输入自定义的缓存命令
- **执行自定义命令**：执行输入的缓存命令

### 右侧区域：日志和状态

#### 实时状态
- **当前位置(DPOS)**：轴的当前规划位置
- **反馈位置(MPOS)**：轴的当前反馈位置
- **当前速度**：轴的当前运行速度
- **剩余距离**：当前运动的剩余距离

#### 缓存队列信息
- **队列列表**：显示已添加到缓存的命令列表
- **命令类型**：显示每条命令的类型
- **描述信息**：显示命令的详细描述
- **时间戳**：记录命令添加的时间

#### 操作日志
- **日志显示**：显示所有操作的详细日志
- **时间戳记录**：记录每个操作的精确时间
- **错误信息**：显示操作失败的错误信息

## 使用流程

### 1. 基本准备
1. 确保运动控制器已连接
2. 在"连接管理"页面建立控制器连接
3. 选择要测试的轴号

### 2. 缓存状态监控
1. 点击"刷新缓存状态"获取当前缓存信息
2. 观察缓存移动数量和剩余缓存容量
3. 监控当前移动标记和向量缓存距离

### 3. 基本缓存运动测试
1. 设置轴运动参数（在"轴运动控制"页面）
2. 设置移动距离1-3的值
3. 点击"添加单次移动"或"添加序列移动"
4. 观察缓存状态的变化
5. 监控轴的实际运动执行

### 4. 缓存IO控制测试
1. 设置要控制的输出端口号
2. 选择输出状态（开/关）
3. 点击"添加IO控制"将IO操作加入缓存
4. 观察运动过程中IO的同步控制

### 5. 延时控制测试
1. 设置延时时间（毫秒）
2. 点击"添加延时"将延时指令加入缓存
3. 观察运动执行过程中的延时效果

### 6. 自定义命令测试
1. 在命令输入框中输入Basic语法命令
2. 点击"执行自定义命令"
3. 查看命令执行结果和响应

## 常用测试场景

### 场景1：连续运动测试
```
1. 设置移动距离1=10, 距离2=20, 距离3=-15
2. 点击"添加序列移动"
3. 观察轴连续执行三段运动
4. 监控缓存状态变化
```

### 场景2：运动+IO同步测试
```
1. 添加一个移动指令（距离=50）
2. 添加IO控制（端口0，状态=开）
3. 添加延时（1000ms）
4. 添加IO控制（端口0，状态=关）
5. 观察运动过程中的IO同步动作
```

### 场景3：缓存队列满载测试
```
1. 连续添加多个运动指令
2. 观察"剩余缓存数量"的变化
3. 测试缓存队列的容量限制
4. 验证缓存满时的处理机制
```

## 注意事项

### 安全注意事项
- 测试前确保轴的安全限位已正确配置
- 设置合理的运动距离，避免超出安全范围
- 紧急情况下可使用"停止轴运动"立即停止

### 功能限制
- 缓存容量有限，避免添加过多指令
- 部分复杂运动可能需要使用自定义命令
- IO控制的端口号需要与实际硬件配置匹配

### 故障排除
- 如果操作失败，检查控制器连接状态
- 查看操作日志获取详细错误信息
- 必要时使用"清空缓存"重置状态

## 技术说明

### 主要API调用
- `GetMovesBuffered()` - 获取缓存移动数量
- `GetLoaded()` - 检查是否有缓存运动
- `GetRemainBuffer()` - 获取剩余缓存容量
- `Move_Relative()` - 相对运动
- `MoveOp()` - 缓存IO控制
- `MoveDelay()` - 缓存延时
- `Execute_Buffer()` - 执行缓存命令

### 实时更新机制
- 界面每500ms自动更新状态信息
- 缓存状态实时监控
- 日志信息即时显示

---

*此功能基于ZMotionSDK运动缓存API实现，提供了完整的缓存运动测试和监控能力。* 